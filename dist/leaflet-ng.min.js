/* leaflet-ng - 2016-08-09
* https://github.com/justinwp/leaflet-ng#readme
* Copyright (c) 2016 ;
* Last Modified: Tue Aug 09 2016 10:20:40
*/
angular.module("leaflet-ng-core",[]),angular.module("leaflet-ng-core").directive("lfBounds",["leafletHelpers",function(a){return{restrict:"A",scope:!1,replace:!1,require:"leaflet",link:function(b,c,d,e){var f=e.getScope(),g=a.safeApply;e.getMap().then(function(a){a.on("moveend",function(){var b=a.getBounds();g(f,function(){f.lfBounds={northEast:{lng:b.getEast(),lat:b.getNorth()},southWest:{lng:b.getWest(),lat:b.getSouth()}}})})})}}}]),angular.module("leaflet-ng-core").directive("lfCenter",["leafletHelpers",function(a){return{restrict:"A",scope:!1,replace:!1,require:"leaflet",link:function(b,c,d,e){var f=e.getScope(),g=a.safeApply;e.getMap().then(function(a){f.$watch("lfCenter",function(b){a.setView([b.lat,b.lng],b.zoom)},!0),a.on("moveend",function(){g(b,function(){angular.extend(f.lfCenter,{lat:a.getCenter().lat,lng:a.getCenter().lng,zoom:a.getZoom(),autoDiscover:!1})})})})}}}]),angular.module("leaflet-ng-core").directive("leaflet",["$q","leafletData",function(a,b){return{restrict:"EA",replace:!0,scope:{lfDefaults:"=",lfLayers:"=",lfCenter:"=",lfMarkers:"=",lfBounds:"=",lfEvents:"="},transclude:!0,template:'<div class="angular-leaflet-map"><div ng-transclude></div></div>',controller:function(b){this._leafletMap=a.defer(),this.getMap=function(){return this._leafletMap.promise},this.getScope=function(){return b}},link:function(a,c,d,e){var f=new L.Map(c[0],a.lfDefaults);b.set("map",f,d.id),e._leafletMap.resolve(f),f.whenReady(function(){console.log("map ready"),b.set("map",f,d.id),angular.forEach(a.lfEvents,function(a,b){console.log(b),f.on(b,a)})}),a.$on("$destroy",function(){f.remove(),b.destroy(d.id)})}}}]),angular.module("leaflet-ng-core").factory("leafletData",[function(){function a(a){return angular.isDefined(a)?a:"main"}function b(b,c,e){e=a(e),angular.isDefined(d[b])||(d[b]={}),d[b][e]=c}function c(b,c){if(c=a(c),angular.isDefined(d[b])&&angular.isDefined(d[b][c]))return d[b][c]}var d={};return{set:b,get:c,getMap:function(a){return c("map",a)},destroy:function(b){b=a(b),angular.forEach(d,function(a,c){a.hasOwnProperty(b)&&delete d[c][b]})}}}]),angular.module("leaflet-ng-core").factory("leafletHelpers",[function(){return{safeApply:function(a,b){var c=a.$root.$$phase;"$apply"===c||"$digest"===c?a.$eval(b):a.$evalAsync(b)}}}]),angular.module("leaflet-ng-layers",["leaflet-ng-core"]),angular.module("leaflet-ng-layers").directive("lfLayers",["leafletLayers","leafletData","$q",function(a,b,c){var d=a.getAll();return{restrict:"A",scope:!1,replace:!1,require:"leaflet",controller:function(a){a._leafletLayers=c.defer(),this.getLayers=function(){return a._leafletLayers.promise}},link:function(a,c,e,f){var g,h=f.getScope();h.lfLayers;f.getMap().then(function(c){function f(a,b,e){angular.forEach(b,function(b,d){angular.isDefined(a[d])||c.removeLayer(g[e][d])}),angular.forEach(a,function(f,h){var i;angular.isDefined(g[e][h])?(i=g[e][h],angular.equals(a[h].params.options,b[h].params.options)||(angular.extend(i.options,a[h].params.options),i.redraw())):(i=d[f.type].createLayer(f.params),g.overlays[h]=i),f.visible?c.addLayer(i):c.removeLayer(i)})}var i=e.id;g=b.get("layers",i),g=angular.isDefined(g)?g:{},g.baselayers=angular.isDefined(g.baselayers)?g.baselayers:{},g.overlays=angular.isDefined(g.overlays)?g.overlays:{},a._leafletLayers.resolve(g),h.$watch("lfLayers.baselayers",function(a,b){f(a,b,"baselayers")},!0),h.$watch("lfLayers.overlays",function(a,b){f(a,b,"overlays")},!0),b.set("layers",g,i)})}}}]),angular.module("leaflet-ng-layers").factory("leafletLayers",["$log",function(a){function b(b,c){d.hasOwnProperty(b)&&a.error("[leaflet-ng-core] Layer already defined."),d[b]=c}function c(a){return d[a]}var d={xyz:{createLayer:function(a){return L.tileLayer(a.url,a.options)}},wms:{createLayer:function(a){return L.tileLayer.wms(a.url,a.options)}}};return{set:b,get:c,getAll:function(){return d}}}]),angular.module("leaflet-ng-markers",["leaflet-ng-core"]),angular.module("leaflet-ng-markers").directive("lfMarkers",["leafletData","$q","$log",function(a,b,c){return{restrict:"A",scope:!1,replace:!1,require:"leaflet",controller:function(a){a._leafletMarkers=b.defer(),this.getMarkers=function(){return a._leafletMarkers.promise}},link:function(b,c,d,e){var f,g=e.getScope();g.lfMarkers;e.getMap().then(function(c){var e=d.id;f=a.get("markers",e),f=angular.isDefined(f)?f:{},b._leafletMarkers.resolve(f),g.$watch("lfMarkers",function(a,b){angular.forEach(f,function(b,d){angular.isDefined(a[d])||(c.removeLayer(b),delete f[d])}),angular.forEach(a,function(a,b){var d,e=L.latLng([a.lat,a.lng]);angular.isDefined(f[b])?(d=f[b],d.setLatLng(e),angular.extend(d.options,a.options),d.update()):(d=L.marker(e,a.options).addTo(c),c.addLayer(d),f[b]=d)})},!0),a.set("markers",f,e)})}}}]);